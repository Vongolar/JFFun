# Just For Fun 服务器

## 简介
&emsp;&emsp;一款模块化的golang服务器，目前可以作为单点服务器使用，包含网关，简单的游客登陆，单人匹配，一款小型桌游玩法模块。

### 网络
#### 1.模糊网络协议
&emsp;&emsp;网关模块（gate）对网络进行抽象，分为短连接和长连接两类。长连接可以向用户主动发送信息。

&emsp;&emsp;客户端发起的消息都视为请求，每个请求都必须响应。

&emsp;&emsp;目前支持短链接http和长连接websocket。


### 模块
#### 1.Module
&emsp;&emsp;实现Module接口视为单个模块，jserver.Regist()注册模块初始化方法，configs/server.toml设置各个模块的配置文件，每个配置文件启动一个对应的模块，可同时存在多个相同模块提高并发量。

&emsp;&emsp;每个模块有两个固定的线程，一个用来处理任务，一个用来做些定时循环任务，不强制需要。

&emsp;&emsp;模块GetHandler()用来注册模块可以执行的任务。

#### 2.Task通信
&emsp;&emsp;模块之间通过Task对象传递数据，并返回响应。

#### 3.Request响应
&emsp;&emsp;Task对象包含请求Request接口，每种网络实现各自的Request。

&emsp;&emsp;InnerRequest 模块内部请求，Wait()可同步等待，通过NewInnerRequest() 方法创建。

#### 4.Schedule任务调度器
&emsp;&emsp;管理所有模块，并开放了一些公共方法以处理任务，如单个最优模块执行；指定模块执行；多模块执行。开放主动向用户发送消息方法，如果用户保持有长连接，可以成功执行。

&emsp;&emsp;模块崩溃会自动重启该模块。

### 用户权限
&emsp;&emsp;authority包定义了用户可能的权限级别和command对应的权限许可。

### 包名
&emsp;&emsp;一般以j开头，所有可序列化用于模块间以及网络的消息由工具生成在data文件加下，包名一般D开头。

### 引用库
&emsp;&emsp;对于网络、序列化等引用内容，做一层封装或者集中调用，便于以后处于性能考虑换引用或自己实现。

## 未完成的工作
### 1.分布式
&emsp;&emsp;目前只能单点运行，服务器之间需要通信，可能参考redis的分布式架构，而非集群式。

&emsp;&emsp;需要实现的功能是当单点故障或者消费能力不足或者其他原因，将任务转移到其他服务器。

&emsp;&emsp;不使用消息中间件，服务器自己实现均衡分布系统。参考目前的schedule，当本机无法处理时，请求其他服务器完成处理。

&emsp;&emsp;目前只有简单的模块故障转移，没有熔断和服务降级。

### 2.状态分析
&emsp;&emsp;需要一套能够检测服务器性能和运行状态的守护模块。

### 3.提升性能
&emsp;&emsp;根据状态分析和参考，选择更优的数据结构，目前用到的结构简单单一。

### 4.数据库和缓存
&emsp;&emsp;目前直接调用mysql和redis，需要考虑能否进一步抽象，但不支持ORM，不希望为了抽象而牺牲性能，可以考虑每个模块各自实现，集中管理的方式。

### 5.统计
&emsp;&emsp;缺少常见的统计功能。

## 欢迎加入
&emsp;&emsp;如项目名字，没有明确说这个框架要做什么，只要觉得有趣的模块，都可以加入进来。当然，模块独立。不然别人就无法快乐了。

&emsp;&emsp;没有固定的模式的框架，如果有更好更快乐的实现方式就用它。

&emsp;&emsp;不要想着要不要封装、抽象，为不明确的事情去架构。如果复制粘贴觉得快乐就复制粘贴，当不快乐时说明需要封装了。

&emsp;&emsp;目前个人开发倾向是桌游的服务端，另外配套的桌游客户端还在进行中没有出来，等能够顺利运行之后会开放出来。期待有人能尝试用U3d或者UE4来制作一个VR桌游框架来。